package manager;

import java.util.Date;
import java.util.List;

import javax.persistence.EntityManager;

import model.Kupovina;
import model.Osoba;
import model.Stavka;

public class KupovinaManager {
	public static boolean izvrsiKupovinu(int idOsoba, String idDostavaStr) {
		EntityManager em = JPAUtil.getEntityManager();
		em.getTransaction().begin();
		try {
			String idDostava = Integer.parseInt(idDostavaStr);
			Osoba osoba = OsobaManager.getOsobaById(idOsoba);
			List<Stavka> listaStavki = osoba.getStavkas();
			osoba.setStavkas(null);
			em.merge(osoba);
			em.flush();
			Kupovina kupovina = new Kupovina();
			kupovina.setStavkas(listaStavki);
			kupovina.setDatum(new Date());
			kupovina.setOsoba(OsobaManager.getOsobaById(idOsoba));
			kupovina.setDostava(dostava);
			em.getTransaction().commit();
			em.close();
			return true;
		}catch(Exception e) {
			return false;
		}
	}
}
