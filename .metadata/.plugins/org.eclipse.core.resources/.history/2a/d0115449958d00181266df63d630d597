package manager;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import javax.persistence.EntityManager;

import model.Kupovina;
import model.Osoba;
import model.Stavka;

public class KupovinaManager {
	public static boolean izvrsiKupovinu(int idOsoba, String idDostavaStr) {
		EntityManager em = JPAUtil.getEntityManager();
		em.getTransaction().begin();
		try {
			Integer idDostava = Integer.parseInt(idDostavaStr);
			Osoba osoba = OsobaManager.getOsobaById(idOsoba);
			List<Stavka> listaStavki = osoba.getStavkas();
			for (Stavka stavka : listaStavki) {
				List <Osoba> listaOsoba = stavka.getOsobas();
				listaOsoba.remove(osoba);
				em.merge(stavka);
				em.flush();
			}
			Kupovina kupovina = new Kupovina();
			kupovina.setStavkas(listaStavki);
			kupovina.setDatum(new Date());
			kupovina.setOsoba(OsobaManager.getOsobaById(idOsoba));
			kupovina.setDostava(DostavaManager.getDostavaById(idDostava));
			em.persist(kupovina);
			em.getTransaction().commit();
			em.close();
			return true;
		}catch(Exception e) {
			e.printStackTrace();
			em.close();
			return false;
		}
	}
	
	public static void main(String[] args) {
		System.out.println("------------------>"+izvrsiKupovinu(1,"1"));
	}
}